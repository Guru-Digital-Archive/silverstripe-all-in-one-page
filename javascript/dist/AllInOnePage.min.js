/*
 *  Silverstripe all in one page - v0.1
 *  Shows all top level pages in one long scrolling page
 *  
 *
 *  Made by Corey Sewell - Guru Digital Media
 *  Under BSD-3-Clause License
 */
function _hashSearch(){var a;this.set=function(b,c){a[b]=c,this.push()},this.remove=function(b){delete a[b],this.push()},this.get=function(b){return a[b]},this.keyExists=function(b){return a.hasOwnProperty(b)},this.push=function(){var b,c,d=[];for(b in a)a.hasOwnProperty(b)&&(b=escape(b),c=escape(a[b]),d.push(b+("undefined"!==c?"="+c:"")));window.location.hash=d.join("&")},this.load=function(){a={};var b,c,d,e=window.location.hash;for(e=e.substring(1,e.length),b=e.split("&"),d=0;d<b.length;d++)c=b[d].split("="),a[unescape(c[0])]="undefined"!=typeof c[1]?unescape(c[1]):c[1]},this.load()}var HashSearch=new _hashSearch;!function(a){var b={navWrap:".nav.navbar-nav, nav.primary",topOffset:0,scrollStopTimeOut:500,anchorActiveClass:"active current",bottomOffset:100,currentPageOffset:[-5,100],scrollEaseEffect:"easeInOutExpo",scrollTime:1e3},c=a(window),d=a(document);a.entwine("ss.allInOnePage",function(a){var e={isScrolling:!1,lastId:null,currentUrl:HashSearch.keyExists("url")?HashSearch.get("url"):null==window.location.href.match(/.+?\:\/\/.+?(\/.+?)(?:#|\?|$)/)?"":window.location.href.match(/.+?\:\/\/.+?(\/.+?)(?:#|\?|$)/)[1]};a("a").click(function(b){var c,d=[a(this).attr("href"),a(this).attr("href")+"home/"],e=0;for(e=0;e<d.length&&(c=a('.page-wrap[data-page-url="'+d[e]+'"]'),!c.length);e++);c&&c.length&&(b.preventDefault(),c.scrollTo())}),a(".back-to-top a").click(function(c){c.preventDefault(),a("body,html").animate({scrollTop:0},b.scrollTime,b.scrollEaseEffect,function(){setTimeout(function(){e.isScrolling=!1},e.scrollStopTimeOut)})}),a(".page-wrap").entwine({onmatch:function(){var b=[this.pageUrl(),this.pageUrl().replace(/\/.*\/(.)/g,"/$1").replace(/home\/$/,"")];a.inArray(e.currentUrl,b)>=0&&this.scrollTo(0,b[0])},pageId:function(){return this.attr("data-page-id")},pageUrl:function(){return this.attr("data-page-url")},pageTitle:function(){return this.attr("data-page-title")},setAsCurrentPage:function(){var c=this.pageId(),d={hitType:"pageview",page:this.pageUrl()};c!==e.lastId&&(e.lastId=c,this.pageTitle()&&(d.title=this.pageTitle(),document.title=this.pageTitle()),this.pageUrl()&&("undefined"!=typeof ga?ga("send",d):"undefined"!=typeof _gaq&&_gaq.push(["_trackPageview",this.pageUrl()]),e.currentUrl!==this.pageUrl()&&("function"==typeof window.history.replaceState?window.history.replaceState({},"",this.pageUrl()):HashSearch.set("url",this.pageUrl())),a(b.navWrap).find("."+b.anchorActiveClass.replace(/\s{1,}/g,", .")).removeClass(b.anchorActiveClass),a(b.navWrap).find('a[href="'+this.pageUrl()+'"]').parent().addClass(b.anchorActiveClass)))},scrollTo:function(c){e.isScrolling=!0,c=void 0!==c?c:b.scrollTime;var d=a("body,html").stop(),f=this.offset().top-b.topOffset,g=function(){setTimeout(function(){e.isScrolling=!1},e.scrollStopTimeOut)};this.setAsCurrentPage(),c>0?d.animate({scrollTop:f},c,b.scrollEaseEffect,g):(d.scrollTop(f),g())}}),c.scroll(function(){if(!e.isScrolling){var f,g=d.height()-(c.scrollTop()+c.height());f=g<b.bottomOffset?a(".page-wrap").last():a(".page-wrap").filter(function(){var d=c.scrollTop(),e=a(this).offset().top,f=e-d;return f>=b.currentPageOffset[0]&&f<=b.currentPageOffset[1]}),f.setAsCurrentPage()}})})}(jQuery);